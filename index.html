<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galerie AR — Test</title>
  <style>
    :root {
      --bg: #f9fafb;
      --fg: #111827;
      --muted: #6b7280;
      --card: #fff;
      --radius: 16px;
      --shadow: 0 4px 16px rgba(0,0,0,0.08);
      --accent: #2563eb;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
    }

    header {
      position: sticky;
      top: 0;
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 20;
    }
    header .brand { font-weight: 700; font-size: 18px; }

    .btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      padding: 10px 16px;
      font-size: 15px;
      cursor: pointer;
      box-shadow: var(--shadow);
    }
    .btn:active { transform: scale(0.97); }

    main {
      padding: 16px;
      max-width: 1000px;
      margin: auto;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (min-width: 640px) {
      .grid { grid-template-columns: repeat(3, 1fr); }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      transition: transform .15s ease;
    }
    .card:hover { transform: translateY(-2px); }

    .thumb {
      aspect-ratio: 1 / 1;
      object-fit: contain;
      width: 100%;
      background: #f3f4f6;
    }

    .meta {
      padding: 10px 12px;
    }
    .title {
      font-weight: 600;
      font-size: 15px;
    }
    .sub {
      font-size: 13px;
      color: var(--muted);
    }

    .ar-badge {
      position: absolute;
      top: 8px;
      left: 8px;
      background: var(--accent);
      color: #fff;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: #111827;
      color: #fff;
      padding: 8px 14px;
      border-radius: 10px;
      opacity: 0;
      transition: opacity .2s ease;
      font-size: 14px;
    }
    .toast.show { opacity: 1; }

    footer {
      text-align: center;
      padding: 30px 12px;
      color: var(--muted);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">Galerie AR</div>
    <button id="shareBtn" class="btn">Partager</button>
  </header>

  <main>
    <ul id="grid" class="grid"></ul>
  </main>

  <div id="toast" class="toast"></div>

  <footer>
    © <span id="year"></span> — Galerie AR. Test models inclus.
  </footer>

  <script>
    // =============== MODELES DE TEST =================
    const DESIGNS = [
      {
        id: "test-001",
        title: "Cube",
        category: "Base",
        dimensions: "10 × 10 × 10 cm",
        thumb: "https://via.placeholder.com/400x400.png?text=Cube",
        usdzUrl: "https://modelviewer.dev/shared-assets/models/Astronaut.usdz",
        glbUrl: "https://modelviewer.dev/shared-assets/models/Astronaut.glb"
      },
      {
        id: "test-002",
        title: "Vase",
        category: "Base",
        dimensions: "25 cm",
        thumb: "https://via.placeholder.com/400x400.png?text=Vase",
        usdzUrl: "https://storage.googleapis.com/ar-answers-in-search-models/static/Tiger.usdz",
        glbUrl: "https://storage.googleapis.com/ar-answers-in-search-models/static/Tiger.glb"
      },
      {
        id: "test-003",
        title: "Chaise",
        category: "Base",
        dimensions: "40 × 40 × 80 cm",
        thumb: "https://via.placeholder.com/400x400.png?text=Chaise",
        usdzUrl: "https://storage.googleapis.com/ar-answers-in-search-models/static/Chair.usdz",
        glbUrl: "https://storage.googleapis.com/ar-answers-in-search-models/static/Chair.glb"
      },
    ];

    // Helpers
    const isIOS = () => /iPhone|iPad|iPod/i.test(navigator.userAgent) ||
      (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    const isAndroid = () => /Android/i.test(navigator.userAgent);

    function showToast(msg){
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> el.classList.remove('show'), 2200);
    }

    // Ouverture AR
    function openARForItem(item){
      if (isIOS()){
        const a = document.createElement('a');
        a.setAttribute('rel', 'ar');
        a.setAttribute('href', item.usdzUrl);
        document.body.appendChild(a);
        a.click();
        setTimeout(()=> a.remove(), 1000);
      } else if (isAndroid()){
        const src = new URL(item.glbUrl, window.location.href).toString();
        const sceneViewerUrl =
          `https://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(src)}&mode=ar_only&link=${encodeURIComponent(window.location.href)}`;
        window.location.href = sceneViewerUrl;
      } else {
        showToast('Ouvre ce lien depuis un smartphone pour la RA.');
      }
    }

    // Rendu
    const grid = document.getElementById('grid');
    DESIGNS.forEach(item => {
      const li = document.createElement('li');
      li.className = 'card';
      li.tabIndex = 0;
      li.setAttribute('role', 'button');
      li.setAttribute('aria-label', `${item.title}, ${item.category}, ${item.dimensions}. Ouvrir en réalité augmentée`);

      const img = document.createElement('img');
      img.className = 'thumb';
      img.src = item.thumb;
      img.alt = item.title;
      img.loading = "lazy";

      const meta = document.createElement('div');
      meta.className = 'meta';
      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = item.title;
      const sub = document.createElement('div');
      sub.className = 'sub';
      sub.textContent = `${item.category} • ${item.dimensions}`;
      meta.appendChild(title);
      meta.appendChild(sub);

      li.appendChild(img);
      li.appendChild(meta);

      li.addEventListener('click', ()=> openARForItem(item));
      li.addEventListener('keydown', (e)=> { if (e.key === 'Enter' || e.key === ' ') openARForItem(item); });

      grid.appendChild(li);
    });

    // Partage
    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      const url = window.location.href;
      const data = { title: document.title, text: 'Découvre mes tests AR', url };
      if (navigator.share){
        try { await navigator.share(data); } catch {}
      } else if (navigator.clipboard){
        try { await navigator.clipboard.writeText(url); showToast("Lien copié ✅"); } catch {}
      }
    });

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
